<%= form_with model: resource, url: registration_path(resource_name), local: true do |f| %>

  <div class="profile-edit-page">
    <div class="profile-card profile-card-image" data-controller="image-preview">
      <div class="image-row">
        <div class="avatar-box">
          <% if resource.avatar.attached? %>
            <%= image_tag url_for(resource.avatar),
                  class: "avatar-preview",
                  data: { image_preview_target: "preview" },
                  alt: "プロフィール画像プレビュー" %>
          <% else %>
            <%= image_tag "",
                  class: "avatar-preview",
                  data: { image_preview_target: "preview" },
                  style: "display:none;",
                  alt: "プロフィール画像プレビュー" %>
          <% end %>
          <div class="avatar-placeholder" data-image-preview-target="placeholder"
              <%= "style='display:none;'" if resource.avatar.attached? %>>
            <span class="avatar-icon"></span>
          </div>
        </div>
        <div class="image-uploader">
          <%= f.label :avatar, "プロフィール画像", class: "field-label" %>
          <label class="upload-button small">
            画像を選択
            <%= f.file_field :avatar, accept: "image/*", class: "hidden-file-input", data: { action: "change->image-preview#show", image_preview_target: "input" } %>
          </label>
        </div>
      </div>
    </div>

    <div class="profile-card">
      <div class="profile-form">
        <div class="profile-field">
          <%= f.label :name, "ニックネーム", class: "field-label" %>
          <%= f.text_field :name, autocomplete: "name", class: "underline-input" %>
        </div>

        <div class="profile-field">
          <%= f.label :email, "メールアドレス", class: "field-label" %>
          <div class="email-field-container">
            <%= f.email_field :email, autocomplete: "email", readonly: true, class: "underline-input" %>
            <%= link_to "変更", change_email_path, class: "email-change-button" %>
          </div>

          <%if current_user.unconfirmed_email.present? %>
            <div class="alert alert-info mt-2">
              <small>
                新しいメールアドレス「<%= current_user.unconfirmed_email %>」の確認待ちです。
                確認メールをご確認ください。
              </small>
            </div>
          <% end %>
        </div>

        <div class="profile-field">
          <%= f.label :height_range, "身長", class: "field-label" %>
          <%= f.select :height_range,
                options_for_select(
                  User.height_ranges.map { |k, v| [enum_display_name(resource, :height_range, k), k] },
                  resource.height_range ),
                {},
                class: "underline-input" %>
        </div>

        <div class="profile-field">
          <div class="field-label-with-link">
            <%= f.label :style_category, "骨格", class: "field-label" %>
            <span class="profile-note-inline">
              自分の骨格タイプが知りたい方は、
              <%= link_to "こちら", "https://fashion.or.jp/stylecheck/", target: "_blank", rel: "noopener" %>
            </span>
          </div>
          <%= f.select :style_category,
                options_for_select(
                  User.style_categories.map { |k, v| [enum_display_name(resource, :style_category, k), k] },
                  resource.style_category ),
                {},
                class: "underline-input" %>
        </div>

        <div class="profile-note">
          パスワードを変更したい方は、
          <%= link_to "こちら", new_user_password_path %>
        </div>
      </div>
    </div>

    <div class="profile-actions">
      <%= f.submit "更新", class: "profile-submit-button" %>
    </div>
  </div>
<% end %>
